#!/usr/bin/env bash
# Status script for dwm
# colours: 01:normal 02:white 03:red 04:green 05:yellow 06:blue
# 07:cyan 08:magenta 09:grey

# Copyright (c) 2013-2016 Jason W Ryan
# The MIT License (MIT) http://opensource.org/licenses/MIT

bat(){
  onl="$(</sys/class/power_supply/AC/online)"
  charge="$(</sys/class/power_supply/BAT0/capacity)"
  if [[ $onl -eq 0 && $charge -ge 15 ]]; then
    printf "%b" "BAT $charge%"
  elif [[ $onl -eq 0 && $charge -le 14 ]]; then
    printf "%b" "BAT $charge%"
  else
    printf "%b" "AC $charge%"
  fi
}

mem(){
  mem="$(awk '/^Mem/ {print $3}' <(free -m))"
  printf "%b" "$mem"
}

# CPU line courtesy Procyon:
# https://bbs.archlinux.org/viewtopic.php?pid=874333#p874333
cpu(){
  read cpu a b c previdle rest < /proc/stat
  prevtotal=$((a+b+c+previdle))
  sleep 0.5
  read cpu a b c idle rest < /proc/stat
  total=$((a+b+c+idle))
  cpu="$((100*( (total-prevtotal) - (idle-previdle) ) / (total-prevtotal) ))"
  printf "%b" "$cpu%"
}

int(){
  host google.com>/dev/null &&
  printf "%b" "ON" || printf "%b" "NO"
}

dte(){
  dte="$(date "+%H:%M %d.%m.%Y")"
  printf "%b" "$dte"
}

# Pipe to status bar
xsetroot -name "$(bat) • CPU $(cpu) • MEM $(mem) • NET $(int) • $(dte)"
